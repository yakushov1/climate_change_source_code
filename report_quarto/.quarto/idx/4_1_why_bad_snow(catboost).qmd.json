{"title":"Соотнесение информации о снежном покрове, полученной из различных источников","markdown":{"yaml":{"title":"Соотнесение информации о снежном покрове, полученной из различных источников","author":"Vasily Yakushov","format":{"html":{"code-fold":true,"code-tools":true}}},"headingText":"Шаг 1: Загрузка необходимых библиотек.","containsRefs":false,"markdown":"\n\nДанные о степени покрытия почвы снегом до 2005 года записаны в виде баллов: 1 балл = 10% покрытия почвы снегом. А после 2005 года - в виде текстового описания. Данные были упрощены до 2 градаций: снег покрывает более или менее половины поверхности почвы. Задача: соотносятся ли результаты из разных источников?\n\\ Схема решения следующая: сначала обучаем модель на тренировочной выборке (данные после 2005 года, проверям на валидационной части выборки (оставшиеся данные после 2005 года)). Затем проверям предсказания модели на тестовой выборке (данные до 2005 года, целевая переменная в которой была в виде баллов), если точность высокая, то данные сопоставимы.\\\nВ качестве модели был выбран catboost, расчеты реализованы на python\n\n```{python}\nimport pandas as pd\nfrom catboost import CatBoostClassifier\nfrom catboost import Pool\nimport shap\nimport matplotlib.pyplot as pl\nimport matplotlib\nfrom matplotlib.ticker import NullLocator\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score, precision_score\nfrom catboost.utils import get_roc_curve\nimport sklearn\nfrom sklearn import metrics\nimport matplotlib.pyplot as plt\n\n```\n\n### Шаг 2: Загрузка данных\n```{python}\ndata = pd.read_csv(\"../initial_data/climate/snow__quality_with_other_parametrs.csv\", sep = ';', decimal = ',')\ndata = data[(data['Month']>=9) | (data['Month']<=5)] # отберем данные только за зимний период\nnew_data = data[((data['Year']==2005) & (data['Month']>1)) | (data['Year']>2005)]\nold_data = data[(data['Year']<2005)]\nX_new = new_data.drop(['Sn_quality', 'Date', 'Year', 'Day', 'Month'], axis=1)\ny_new = new_data['Sn_quality']\n```\n### Шаг 3: Тренировочная и валидационная выборки на данных после 2005 года\n```{python}\nX_train, X_val, y_train, y_val = train_test_split(X_new, y_new, test_size=0.2, random_state=42)\n```\n\n### Шаг 4: Тестовая часть выборки - данные до 2005 года\n```{python}\nX_test = old_data.drop(['Sn_quality', 'Date', 'Year', 'Day', \"Month\"], axis=1)\ny_test = old_data['Sn_quality']\n```\n### Шаг 5: Построение модели\n\n```{python}\nmodel_with_early_stop=CatBoostClassifier(\n    eval_metric='AUC',\n    iterations=200,\n    random_seed=63,\n    learning_rate=0.3,\n    early_stopping_rounds=20)\nmodel_with_early_stop.fit(\n    X_train,y_train,\n    eval_set=(X_val, y_val),\n    verbose=False,\n    plot=True\n)\n```\n### Шаг 6: Оценка модели на валидационной (слева) и тестовой (справа) выборке\n\n```{python}\n\n# оценка на валидационной выборке\nplt.figure(figsize=(8,5))\nlw=2\nplt.subplot(1, 2, 1)\neval_pool = Pool(X_val, y_val)\ncurve = get_roc_curve(model_with_early_stop, eval_pool)\n(fpr, tpr, thresholds)=curve\nroc_auc=sklearn.metrics.auc(fpr, tpr)\n\nplt.plot(fpr, tpr, color='darkorange',\n         lw=lw, label='ROC curve (area = %0.2f)' % roc_auc, alpha=0.5)\n\nplt.plot([0, 1], [0, 1], color='navy', lw=lw, linestyle='--', alpha=0.5)\n\nplt.xlim([0.0, 1.0])\nplt.ylim([0.0, 1.05])\nplt.xticks(fontsize=8)\nplt.yticks(fontsize=8)\nplt.grid(True)\nplt.ylabel('True Positive Rate', fontsize=8)\nplt.title('A', fontsize=8)\nplt.legend(loc=\"lower right\", fontsize=8)\n\n\n\n# оценка на тестовой  выборке\npl.subplot(1, 2, 2)\neval_pool = Pool(X_test, y_test )\ncurve = get_roc_curve(model_with_early_stop, eval_pool)\n(fpr, tpr, thresholds)=curve\nroc_auc=sklearn.metrics.auc(fpr, tpr)\nplt.plot(fpr, tpr, color='darkorange',\n         lw=lw, label='ROC curve (area = %0.2f)' % roc_auc, alpha=0.5)\n\nplt.plot([0, 1], [0, 1], color='navy', lw=lw, linestyle='--', alpha=0.5)\n\nplt.xlim([0.0, 1.0])\nplt.ylim([0.0, 1.05])\nplt.xticks(fontsize=8)\nplt.yticks(fontsize=8)\nplt.grid(True)\nplt.title('Б', fontsize=8)\n\nplt.legend(loc=\"lower right\", fontsize=8)\ntxt=\"False Positive Rate\"\nplt.figtext(0.5, 0.01, txt, wrap=True, horizontalalignment='center', fontsize=10)\nplt.show()\n```\nВидим, что площадь под кривой в обоих случаях большая (0.97 на валидации и 0.96 на тестовой выборке), следовательно, делаем вывод, что данные из разных источников хорошо соотносятся друг с другом.","srcMarkdownNoYaml":"\n\nДанные о степени покрытия почвы снегом до 2005 года записаны в виде баллов: 1 балл = 10% покрытия почвы снегом. А после 2005 года - в виде текстового описания. Данные были упрощены до 2 градаций: снег покрывает более или менее половины поверхности почвы. Задача: соотносятся ли результаты из разных источников?\n\\ Схема решения следующая: сначала обучаем модель на тренировочной выборке (данные после 2005 года, проверям на валидационной части выборки (оставшиеся данные после 2005 года)). Затем проверям предсказания модели на тестовой выборке (данные до 2005 года, целевая переменная в которой была в виде баллов), если точность высокая, то данные сопоставимы.\\\nВ качестве модели был выбран catboost, расчеты реализованы на python\n\n### Шаг 1: Загрузка необходимых библиотек.\n```{python}\nimport pandas as pd\nfrom catboost import CatBoostClassifier\nfrom catboost import Pool\nimport shap\nimport matplotlib.pyplot as pl\nimport matplotlib\nfrom matplotlib.ticker import NullLocator\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score, precision_score\nfrom catboost.utils import get_roc_curve\nimport sklearn\nfrom sklearn import metrics\nimport matplotlib.pyplot as plt\n\n```\n\n### Шаг 2: Загрузка данных\n```{python}\ndata = pd.read_csv(\"../initial_data/climate/snow__quality_with_other_parametrs.csv\", sep = ';', decimal = ',')\ndata = data[(data['Month']>=9) | (data['Month']<=5)] # отберем данные только за зимний период\nnew_data = data[((data['Year']==2005) & (data['Month']>1)) | (data['Year']>2005)]\nold_data = data[(data['Year']<2005)]\nX_new = new_data.drop(['Sn_quality', 'Date', 'Year', 'Day', 'Month'], axis=1)\ny_new = new_data['Sn_quality']\n```\n### Шаг 3: Тренировочная и валидационная выборки на данных после 2005 года\n```{python}\nX_train, X_val, y_train, y_val = train_test_split(X_new, y_new, test_size=0.2, random_state=42)\n```\n\n### Шаг 4: Тестовая часть выборки - данные до 2005 года\n```{python}\nX_test = old_data.drop(['Sn_quality', 'Date', 'Year', 'Day', \"Month\"], axis=1)\ny_test = old_data['Sn_quality']\n```\n### Шаг 5: Построение модели\n\n```{python}\nmodel_with_early_stop=CatBoostClassifier(\n    eval_metric='AUC',\n    iterations=200,\n    random_seed=63,\n    learning_rate=0.3,\n    early_stopping_rounds=20)\nmodel_with_early_stop.fit(\n    X_train,y_train,\n    eval_set=(X_val, y_val),\n    verbose=False,\n    plot=True\n)\n```\n### Шаг 6: Оценка модели на валидационной (слева) и тестовой (справа) выборке\n\n```{python}\n\n# оценка на валидационной выборке\nplt.figure(figsize=(8,5))\nlw=2\nplt.subplot(1, 2, 1)\neval_pool = Pool(X_val, y_val)\ncurve = get_roc_curve(model_with_early_stop, eval_pool)\n(fpr, tpr, thresholds)=curve\nroc_auc=sklearn.metrics.auc(fpr, tpr)\n\nplt.plot(fpr, tpr, color='darkorange',\n         lw=lw, label='ROC curve (area = %0.2f)' % roc_auc, alpha=0.5)\n\nplt.plot([0, 1], [0, 1], color='navy', lw=lw, linestyle='--', alpha=0.5)\n\nplt.xlim([0.0, 1.0])\nplt.ylim([0.0, 1.05])\nplt.xticks(fontsize=8)\nplt.yticks(fontsize=8)\nplt.grid(True)\nplt.ylabel('True Positive Rate', fontsize=8)\nplt.title('A', fontsize=8)\nplt.legend(loc=\"lower right\", fontsize=8)\n\n\n\n# оценка на тестовой  выборке\npl.subplot(1, 2, 2)\neval_pool = Pool(X_test, y_test )\ncurve = get_roc_curve(model_with_early_stop, eval_pool)\n(fpr, tpr, thresholds)=curve\nroc_auc=sklearn.metrics.auc(fpr, tpr)\nplt.plot(fpr, tpr, color='darkorange',\n         lw=lw, label='ROC curve (area = %0.2f)' % roc_auc, alpha=0.5)\n\nplt.plot([0, 1], [0, 1], color='navy', lw=lw, linestyle='--', alpha=0.5)\n\nplt.xlim([0.0, 1.0])\nplt.ylim([0.0, 1.05])\nplt.xticks(fontsize=8)\nplt.yticks(fontsize=8)\nplt.grid(True)\nplt.title('Б', fontsize=8)\n\nplt.legend(loc=\"lower right\", fontsize=8)\ntxt=\"False Positive Rate\"\nplt.figtext(0.5, 0.01, txt, wrap=True, horizontalalignment='center', fontsize=10)\nplt.show()\n```\nВидим, что площадь под кривой в обоих случаях большая (0.97 на валидации и 0.96 на тестовой выборке), следовательно, делаем вывод, что данные из разных источников хорошо соотносятся друг с другом."},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"4_1_why_bad_snow(catboost).html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","editor":"visual","theme":"cosmo","title":"Соотнесение информации о снежном покрове, полученной из различных источников","author":"Vasily Yakushov"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}