"0","#| label: Функция считывания файлов"
"0","#| warning: false"
"0","read_files <- function(x){"
"0","  df <- read_excel(x) |>  "
"0","    mutate(Local_time = as_datetime(Local_time, format = ""%d.%m.%Y %R"")) |> "
"0","    mutate(Year = year(Local_time),"
"0","           Month = as.factor(month(Local_time)),"
"0","           Day = mday(Local_time)) |> "
"0","    select(Year, Month, Day, Tavg=T, Pr=RRR, Sn=sss, Sn_description = `E'`) |> "
"0","    mutate(Pr = case_when(Pr == ""Осадков нет"" | Pr == ""Следы осадков"" ~ ""0"","
"0","                          .default = Pr)) |> "
"0","    arrange(Year, Month, Day) |>"
"0","    mutate(across(c(Year:Day, Sn_description), as.factor),"
"0","           across(Tavg:Sn, as.numeric)) |> "
"0","    group_by(Year, Month, Day) |>"
"0","    summarise("
"0","      Tavg = mean(Tavg, na.rm = T),"
"0","      Pr = sum(Pr, na.rm = T), # Потому что это накопленные осадки, нужно суммировать"
"0","      Sn = mean(Sn, na.rm = T),"
"0","      Sn_description = as.factor(str_flatten(Sn_description, "", "", na.rm = T))"
"0","    )"
"0","  return(df)"
"0","}"
